<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SWIL</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Arial,sans-serif;background:url('https://i.pinimg.com/736x/68/aa/c8/68aac8479ce6bd16304fda727f9c2486.jpg') center/cover fixed;color:#000;min-height:100vh;overflow-x:hidden;}
  #body-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:url('https://64.media.tumblr.com/8871518c1f104c9cede189ba8a041913/tumblr_n02trm8qkq1svwlszo1_r1_500.gif') no-repeat center/cover;pointer-events:none;z-index:0}
  #top-banner{position:fixed;top:0;left:50%;transform:translateX(-50%);width:100%;max-width:600px;z-index:2}
  h1{font-size:4.5rem;text-align:center;margin-top:140px;color:black;-webkit-text-stroke:2px red;z-index:2;position:relative}
  h2{text-align:center;margin-bottom:30px;color:black;-webkit-text-stroke:1px red;position:relative;z-index:2}
  #side-left,#side-right{position:fixed;top:0;width:80px;height:100%;background:url('https://media4.giphy.com/media/10a8AOSeP6Rqfu/200w.gif') repeat-y;background-size:80px auto;z-index:2}
  #side-left{left:0}#side-right{right:0}
  #big-left,#big-right{position:fixed;top:0;width:100px;height:100%;background:url('https://64.media.tumblr.com/a33b974be0ceb710cad1e2d90852ea7f/6fefe7acdbd459ca-79/s250x400/67d4aca6996622af3a2998bb085fe2982567a931.gif') no-repeat center center;background-size:contain;z-index:1}
  #big-left{left:90px}#big-right{right:90px}
  #corner-dog{position:fixed;bottom:20px;left:20px;width:80px;z-index:10}
  #bottom-gif{position:fixed;bottom:0;right:50%;transform:translateX(50%);width:150px;z-index:5}
  #login-section,#post-section{width:90%;max-width:820px;margin:12px auto;background:rgba(255,255,255,0.9);padding:14px;border-radius:10px;position:relative;z-index:3}
  #posts{width:90%;max-width:820px;margin:12px auto 160px auto;position:relative;z-index:3}
  .post,.comment{background:rgba(255,255,255,0.98);padding:10px;border-radius:8px;margin:10px 0}
  .post small{display:block;color:#666;margin-top:8px;font-size:0.9rem}
  .comment .admin-header{font-weight:bold;color:black;text-shadow:2px 0 red,-2px 0 red,0 2px red,0 -2px red;margin-bottom:6px}
  textarea{width:100%;min-height:60px;padding:8px;border-radius:6px;border:1px solid #ccc}
  input[type=file]{width:100%}
  button{padding:7px 10px;border-radius:6px;border:0;background:#222;color:#fff;cursor:pointer}
  #music-player{position:fixed;bottom:20px;right:20px;background:rgba(255,255,255,0.95);padding:10px;border-radius:8px;width:260px;z-index:999}
  #debug{position:fixed;right:10px;bottom:10px;max-width:420px;background:rgba(0,0,0,0.72);color:#fff;padding:8px;border-radius:8px;z-index:9999;font-size:0.85rem;overflow:auto;max-height:220px}
</style>
</head>
<body>

<div id="body-overlay"></div>
<img id="top-banner" src="https://media.tenor.com/lu7ZRQm96x0AAAAi/heart-banner-kawaii.gif" alt="banner" />
<div id="side-left"></div><div id="side-right"></div>
<div id="big-left"></div><div id="big-right"></div>
<img id="corner-dog" src="https://i.gzn.jp/img/2022/02/22/fastest-gif-animation/dancing-dog-2.gif" alt="dog" />
<img id="bottom-gif" src="https://platform.vox.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/8688491/hiE5vMs.gif" alt="bottom" />

<h1>SWIL</h1>
<h2>Sharing - What - I - Like</h2>

<!-- LOGIN -->
<div id="login-section">
  <label for="role-select">Select Role:</label>
  <select id="role-select">
    <option value="guest">Guest</option>
    <option value="admin">Admin</option>
  </select>
  <div id="password-div" style="display:none;margin-top:8px;">
    <input id="admin-password" type="password" placeholder="Admin password">
  </div>
  <div style="margin-top:8px;">
    <button onclick="login()">Login</button>
    <span id="role-status" style="margin-left:12px;font-weight:600">Role: guest</span>
  </div>
</div>

<!-- POST (admin only) -->
<div id="post-section" style="display:none;">
  <h3>Create a Post</h3>
  <textarea id="post-text" placeholder="Write something..."></textarea>
  <div style="margin-top:8px;">
    <input id="post-img" type="text" placeholder="Paste image URL (optional)" />
  </div>
  <div style="margin-top:8px">
    <button onclick="createPost()">Post</button>
  </div>
</div>

<!-- POSTS container -->
<div id="posts"></div>

<!-- Music player -->
<div id="music-player">
  <input id="music-url" type="text" placeholder="YouTube URL" style="width:100%;padding:6px;border-radius:6px;border:1px solid #ccc" />
  <div style="margin-top:6px"><button onclick="playMusic()">Play</button></div>
  <div id="music-container" style="margin-top:8px"></div>
</div>

<!-- Fart sound -->
<audio id="fart-sound" src="https://www.soundjay.com/human/fart-01.mp3" preload="auto"></audio>

<!-- Debug box -->
<div id="debug" aria-live="polite"></div>

<!-- Firebase compat libs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAzZWzC7n-XKAdlCLrGM3TPDl9Uo5rUKzY",
  authDomain: "swil-eb81a.firebaseapp.com",
  databaseURL: "https://swil-eb81a-default-rtdb.firebaseio.com",
  projectId: "swil-eb81a",
  storageBucket: "swil-eb81a.appspot.com",
  messagingSenderId: "964324457027",
  appId: "1:964324457027:web:9c1e7f6331a8c59b52f2f6",
  measurementId: "G-TXP1TJTDD0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();
let role = 'guest';

/* Debug helper */
function logDebug(msg, isError=false){
  const d = document.getElementById('debug');
  const el = document.createElement('div');
  if(isError) el.className='debug-error';
  el.textContent = `${new Date().toLocaleTimeString()} â€” ${msg}`;
  d.prepend(el);
  console[isError?'error':'log'](msg);
}

/* Admin login toggle */
document.getElementById('role-select').addEventListener('change', ()=>{
  document.getElementById('password-div').style.display = document.getElementById('role-select').value==='admin'?'block':'none';
});

/* Login function */
function login(){
  const sel = document.getElementById('role-select').value;
  const pass = document.getElementById('admin-password').value||'';
  if(sel==='admin' && pass==='didifuckingstutter'){
    role='admin';
    document.getElementById('post-section').style.display='block';
    alert('âœ… Logged in as Admin');
  } else {
    role='guest';
    document.getElementById('post-section').style.display='none';
    alert('ðŸ‘¤ Logged in as Guest');
  }
  document.getElementById('role-status').innerText='Role: '+role;
}

/* Create Post */
function createPost(){
  if(role!=='admin'){ alert('Only admin can create posts'); return; }
  const text = document.getElementById('post-text').value.trim();
  const imgUrl = document.getElementById('post-img').value.trim();
  if(!text && !imgUrl){ alert('Write text or provide image URL'); return; }

  const postsRef = db.ref('posts');
  const newRef = postsRef.push();
  newRef.set({
    text: text,
    img: imgUrl||null,
    role: role,
    time: new Date().toLocaleString()
  });

  document.getElementById('post-text').value='';
  document.getElementById('post-img').value='';
  alert('âœ… Post created!');
}

/* Display posts and comments */
function startListening(){
  const postsRef = db.ref('posts');
  postsRef.on('value', snapshot=>{
    const posts = snapshot.val();
    const postsDiv = document.getElementById('posts');
    postsDiv.innerHTML='';

    if(!posts) return;

    for(let postId in posts){
      const p = posts[postId];
      const postDiv = document.createElement('div');
      postDiv.className='post';

      if(p.text){ const t=document.createElement('p'); t.innerText=p.text; postDiv.appendChild(t); }
      if(p.img){ const img=document.createElement('img'); img.src=p.img; img.style.maxWidth='300px'; img.style.display='block'; img.style.marginTop='8px'; postDiv.appendChild(img); }

      const small=document.createElement('small'); small.textContent='Posted at: '+(p.time||''); postDiv.appendChild(small);

      /* Comments container */
      const commentsDiv=document.createElement('div'); commentsDiv.className='comments'; commentsDiv.style.marginTop='8px'; postDiv.appendChild(commentsDiv);

      const ta=document.createElement('textarea'); ta.placeholder='Add a comment'; ta.style.marginTop='8px'; postDiv.appendChild(ta);
      const cBtn=document.createElement('div'); cBtn.style.marginTop='6px';
      const btn=document.createElement('button'); btn.textContent='Comment'; cBtn.appendChild(btn); postDiv.appendChild(cBtn);

      btn.addEventListener('click', ()=>{
        const txt=(ta.value||'').trim(); if(!txt){ alert('Comment cannot be empty'); return; }
        db.ref('posts/'+postId+'/comments').push({text:txt,role:role,timestamp:new Date().toLocaleString()});
        ta.value='';
      });

      db.ref('posts/'+postId+'/comments').on('value', snap=>{
        commentsDiv.innerHTML='';
        const cs = snap.val(); if(!cs) return;
        for(let cid in cs){
          const c = cs[cid];
          const cDiv=document.createElement('div'); cDiv.className='comment';
          if(c.role==='admin'){ const h=document.createElement('div'); h.className='admin-header'; h.innerText='Admin'; cDiv.appendChild(h); }
          const txtNode=document.createElement('div'); txtNode.innerText=c.text||''; cDiv.appendChild(txtNode);
          commentsDiv.appendChild(cDiv);
        }
      });

      postsDiv.appendChild(postDiv);
    }
  }, err=>{ logDebug('DB read failed: '+(err.message||err),true); });
}

/* Music player */
function playMusic(){
  const url=document.getElementById('music-url').value.trim();
  if(!url) return alert('Paste a YouTube URL');
  const m=url.match(/(?:youtube\.com.*v=|youtu\.be\/)([^&\?/]+)/);
  if(!m) return alert('Invalid YouTube URL');
  const id=m[1];
  document.getElementById('music-container').innerHTML=`<iframe width="230" height="80" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
}

/* Flying GIF */
function createFlyingGif(){
  const gif=document.createElement('img');
  gif.src='https://images.squarespace-cdn.com/content/v1/63d184ab563ef27ae4e812ff/a9e680c6-c461-4ff4-a21a-277b00f453aa/Animation+Artist+-+Headexplodie+-+Totally+Reps+33.GIF';
  gif.style.position='absolute'; gif.style.width='120px'; gif.style.zIndex=9998;
  gif.style.left=Math.random()*(window.innerWidth-150)+'px';
  gif.style.top=Math.random()*(window.innerHeight-150)+'px';
  document.body.appendChild(gif);
  setTimeout(()=>gif.remove(),5000);
}
setInterval(createFlyingGif,2000);

/* Fart sound */
document.addEventListener('click', ()=>{ try{ document.getElementById('fart-sound').play().catch(()=>{}); }catch(e){} });

/* Init */
window.addEventListener('DOMContentLoaded', ()=>{
  document.getElementById('post-section').style.display='none';
  document.getElementById('password-div').style.display='none';
  document.getElementById('role-status').innerText='Role: guest';
  startListening();
  logDebug('App initialized and listening for posts...');
});
</script>
</body>
</html>
