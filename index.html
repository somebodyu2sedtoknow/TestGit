<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SWIL</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: url('https://i.pinimg.com/736x/68/aa/c8/68aac8479ce6bd16304fda727f9c2486.jpg') no-repeat center center fixed;
  background-size: cover;
  overflow-x: hidden;
  position: relative;
}
#post-section, #login-section {
  width: 80%; max-width: 800px; margin: 20px auto;
  background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px;
}
.post, .comment {
  background: rgba(255,255,255,0.9); margin: 10px 0; padding: 10px; border-radius: 8px;
}
#music-player {
  position: fixed; bottom: 20px; right: 20px;
  background: rgba(255,255,255,0.9);
  padding: 10px; border-radius: 8px; width: 250px;
  z-index: 1000;
}
</style>
</head>
<body>
<h1 style="text-align:center;">SWIL</h1>
<h2 style="text-align:center;">Sharing - What - I - Like</h2>

<!-- Login -->
<div id="login-section">
  <label>Select Role:</label>
  <select id="role-select" onchange="togglePasswordField()">
    <option value="guest">Guest</option>
    <option value="admin">Admin</option>
  </select>
  <div id="password-div" style="display:none;">
    <input type="password" id="admin-password" placeholder="Enter admin password" />
  </div>
  <button onclick="login()">Login</button>
</div>

<!-- Post Section -->
<div id="post-section" style="display:none;">
  <h3>Create a Post</h3>
  <textarea id="post-text" placeholder="Text"></textarea>
  <input type="file" id="post-file" multiple />
  <button onclick="createPost()">Post</button>
</div>

<!-- Posts -->
<div id="posts"></div>

<!-- Music Player -->
<div id="music-player">
  <input type="text" id="music-url" placeholder="YouTube URL" />
  <button onclick="playMusic()">Play</button>
  <div id="music-container"></div>
</div>

<!-- Fart Sound -->
<audio id="fart-sound" src="https://www.soundjay.com/human/fart-01.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAzZWzC7n-XKAdlCLrGM3TPDl9Uo5rUKzY",
  authDomain: "swil-eb81a.firebaseapp.com",
  databaseURL: "https://swil-eb81a-default-rtdb.firebaseio.com",
  projectId: "swil-eb81a",
  storageBucket: "swil-eb81a.appspot.com",
  messagingSenderId: "964324457027",
  appId: "1:964324457027:web:9c1e7f6331a8c59b52f2f6"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

let role = "guest";

// Toggle password field
function togglePasswordField() {
  const selectedRole = document.getElementById("role-select").value;
  document.getElementById("password-div").style.display =
    selectedRole === "admin" ? "block" : "none";
}
window.togglePasswordField = togglePasswordField;

// Login
function login() {
  const selectedRole = document.getElementById("role-select").value;
  const password = document.getElementById("admin-password").value;

  if (selectedRole === "admin" && password === "didifuckingstutter") {
    role = "admin";
    document.getElementById("post-section").style.display = "block";
    alert("âœ… Logged in as Admin");
  } else {
    role = "guest";
    document.getElementById("post-section").style.display = "none";
    alert("ðŸ‘¤ Logged in as Guest");
  }
}
window.login = login;

// Create Post
async function createPost() {
  if (role !== "admin") return;

  const text = document.getElementById("post-text").value.trim();
  const fileInput = document.getElementById("post-file");
  const timestamp = new Date().toLocaleString();

  let fileURLs = [];

  for (let file of fileInput.files) {
    const storageRef = sRef(storage, "uploads/" + Date.now() + "-" + file.name);
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);
    fileURLs.push(url);
  }

  const postsRef = ref(db, "posts");
  const newPost = push(postsRef);

  await set(newPost, {
    text,
    timestamp,
    files: fileURLs,
    role
  });

  document.getElementById("post-text").value = "";
  fileInput.value = "";
}
window.createPost = createPost;

// Load Posts
function loadPosts() {
  const postsDiv = document.getElementById("posts");
  const postsRef = ref(db, "posts");

  onValue(postsRef, (snapshot) => {
    postsDiv.innerHTML = "";
    const data = snapshot.val();
    if (!data) return;

    Object.keys(data).reverse().forEach(postId => {
      const post = data[postId];
      const postDiv = document.createElement("div");
      postDiv.className = "post";

      let filesHTML = "";
      if (post.files) {
        post.files.forEach(url => {
          if (url.match(/\.(jpg|jpeg|png|gif)$/i)) {
            filesHTML += `<img src="${url}" style="max-width:100%; margin-top:5px;" />`;
          } else if (url.match(/\.(mp4|webm)$/i)) {
            filesHTML += `<video controls style="max-width:100%; margin-top:5px;"><source src="${url}"></video>`;
          } else if (url.match(/\.(mp3|wav)$/i)) {
            filesHTML += `<audio controls style="margin-top:5px;"><source src="${url}"></audio>`;
          }
        });
      }

      postDiv.innerHTML = `
        <p>${post.role === "admin" ? "<b style='color:red'>[Admin]</b> " : ""}${post.text}</p>
        <small>Posted at: ${post.timestamp}</small>
        ${filesHTML}
        <div class="comments"></div>
        <textarea placeholder="Add comment"></textarea>
        <button>Add Comment</button>
      `;
      postsDiv.appendChild(postDiv);

      const commentBox = postDiv.querySelector("textarea");
      const commentBtn = postDiv.querySelector("button");
      const commentsContainer = postDiv.querySelector(".comments");

      commentBtn.onclick = () => {
        if (!commentBox.value.trim()) return;
        const commentRef = ref(db, `posts/${postId}/comments`);
        push(commentRef, { text: commentBox.value, role });
        commentBox.value = "";
      };

      // Load comments
      onValue(ref(db, `posts/${postId}/comments`), (snap) => {
        commentsContainer.innerHTML = "";
        const comments = snap.val();
        if (!comments) return;
        Object.keys(comments).forEach(cid => {
          const c = comments[cid];
          const div = document.createElement("div");
          div.className = "comment";
          div.innerHTML = `${c.role === "admin" ? "<b style='color:red'>Admin:</b> " : ""}${c.text}`;
          commentsContainer.appendChild(div);
        });
      });
    });
  });
}
loadPosts();
window.loadPosts = loadPosts;

// ðŸŽµ Music Player
function playMusic() {
  const url = document.getElementById("music-url").value;
  const match = url.match(/(?:youtube\.com.*v=|youtu\.be\/)([^&]+)/);
  if (!match) return alert("Invalid YouTube URL");
  const id = match[1];
  document.getElementById("music-container").innerHTML =
    `<iframe width="230" height="80" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media"></iframe>`;
}
window.playMusic = playMusic;

// ðŸŽ‡ Flying GIF every 2s
function createFlyingGif() {
  const gif = document.createElement("img");
  gif.src = "https://images.squarespace-cdn.com/content/v1/63d184ab563ef27ae4e812ff/a9e680c6-c461-4ff4-a21a-277b00f453aa/Animation+Artist+-+Headexplodie+-+Totally+Reps+33.GIF";
  gif.style.position = "absolute";
  gif.style.width = "120px";
  gif.style.left = Math.random() * (window.innerWidth - 150) + "px";
  gif.style.top = Math.random() * (window.innerHeight - 150) + "px";
  document.body.appendChild(gif);
  setTimeout(() => gif.remove(), 5000);
}
setInterval(createFlyingGif, 2000);

// ðŸ’¨ Fart sound on click
document.addEventListener("click", () => {
  document.getElementById("fart-sound").play();
});
</script>
</body>
</html>
